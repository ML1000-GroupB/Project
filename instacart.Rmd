---
title: "instacart"
author: 
date: "09/03/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Abstract

The main goal of recommender systems is to provide suggestions to online users to make better decisions from many alternatives available over the Web. A better recommender system is directed more towards personalized recommendations by taking into consideration information about a product, such as specifications, purchase histor the users, comparison with other products, and so on, before making recommendations.

```{r}
library(dplyr)
library(ggplot2)
```


```{r}
#Import data

orders<-read.csv("orders.csv")
products<-read.csv("products.csv")
departments<-read.csv("departments.csv")
prior<-read.csv("order_products__prior.csv")
train<-read.csv("order_products__train.csv")
test<-read.csv("sample_submission.csv")


```
```{r include=FALSE}

#testing

head(orders)
#dim(orders)
orders %>% 
  filter(order_id==2)

orders %>% 
  filter(eval_set=="train")
```
```{r include=FALSE}

#testing
head(prior)
prior %>% 
  filter(order_id==2)

```
```{r}
#merge prior & order 

prior_order<-orders %>% 
  filter(eval_set=="prior") %>% 
    left_join(prior,orders,by=c("order_id"))


```

```{r include=FALSE}

#testing
prior_order%>% 
  filter(order_id==2196797)


prior_order %>% 
  filter(user_id==202279)
```

```{r}
#merge train and order

train_order<-orders %>% 
  filter(eval_set=="train") %>% 
    left_join(train,orders,by=c("order_id"))


```



```{r}
#merge test and order

test_order<-orders %>% 
  filter(eval_set=="test") %>% 
    left_join(test,orders,by=c("order_id"))
```
```{r}
dim(prior_order)
dim(train_order)
dim(test_order)
```


```{r}
## Total users 

user_count<-unique(orders$user_id)
length(user_count)

```


```{r}
#total products
product_count<-unique(products$product_id)
length(product_count)

```


```{r}
orders_count<-unique(orders$order_id)
length(orders_count)
```



```{r}
#total products in prior
product_prior_count<-unique(prior_order$product_id)
length(product_prior_count)

```

```{r}
#total products in train

product_train_count<-unique(train_order$product_id)
length(product_train_count)
```

```{r include=FALSE}
#top 50 products train

top_products_train<-train_order %>% 
 group_by(user_id,product_id) %>% 
 summarise(tot=n()) %>% 
  ungroup() %>% 
  group_by(product_id) %>% 
  summarise(count1=n()) %>% 
  ungroup() %>% 
arrange(desc(count1)) %>% 
top_n(50)

#top_products_train

```


```{r include=FALSE}

# train users for top 50  

train_users<-prior_order %>%
  filter(product_id %in% top_products_train$product_id ) %>% 
 group_by(user_id,product_id) %>% 
  summarise(tot=n()) %>% 
  ungroup() %>% 
  group_by(user_id) %>% 
  summarise(count2=n()) %>% 
 arrange(desc(count2)) 



#train_users

```
```{r}

# top 50  products prior
top_products_prior<-prior_order %>% 
 group_by(user_id,product_id) %>% 
 summarise(tot=n()) %>% 
  ungroup() %>% 
  group_by(product_id) %>% 
  summarise(count1=n()) %>% 
  ungroup() %>% 
arrange(desc(count1)) %>% 
top_n(50)


#top_products_prior

```




```{r}
#prior user for top 50

prior_users<-prior_order %>%
  filter(product_id %in% top_products_prior$product_id ) %>% 
 group_by(user_id,product_id) %>% 
   summarise(tot=n()) %>% 
  ungroup() %>% 
  group_by(user_id) %>% 
  summarise(count2=n()) %>% 
 arrange(desc(count2)) 



#prior_users
```

```{r include=FALSE}
#testing
z<-prior_order %>% 
  filter(product_id %in% top_products_prior$product_id & user_id==201142) %>% 
  distinct(product_id,.keep_all = TRUE)
z




```


```{r include=FALSE}

#transaction for top 50 products (train)

train_order %>% 
filter(user_id %in%train_users$user_id  & product_id %in% top_products_train$product_id)
```


```{r include=FALSE}

#transaction for top 50 products (prior)

prior_order %>% 
filter(user_id %in%prior_users$user_id  & product_id %in% top_products_prior$product_id)

```




```{r include=FALSE}
# top_products<-prior_order %>% 
#  group_by(user_id,product_id) %>% 
#  summarise(tot=n()) %>% 
#   ungroup() %>% 
#   group_by(product_id) %>% 
#   summarise(count1=n()) %>% 
#   ungroup() %>% 
# arrange(desc(count1))
#   
# top_products
```

```{r include=FALSE}
#test

x<-prior_order %>% 
  filter(product_id==24852) %>% 
  distinct(user_id,.keep_all = TRUE)
x
```


```{r}
#Number of distinct orders by user

p1<-orders %>% 
  group_by(user_id) %>% 
  summarise(count_order=n()) %>% 
  ungroup() 

# %>% group_by(count_order) %>% 
#   summarise(count_user=n())

ggplot(p1, aes(count_order)) + geom_histogram(binwidth = 10)+labs(title="Number of distinct orders by user",
        x ="Number of Orders", y = "Number of Users")+coord_cartesian(xlim = c(0, 80))


```

```{r}

#combine prior and train

all<-rbind(train_order,prior_order)
head(all,100)
```

```{r}
#Number of distinct products/user

p2<-all %>% 
  group_by(user_id,product_id) %>% 
  summarise(count3=n()) %>% 
  select(user_id,product_id,count3) %>% 
  ungroup() %>% 
  group_by(user_id) %>% 
  summarise(count_product=n()) %>% 
  ungroup() 
# %>% group_by(count_product) %>% 
#   summarise(count_user=n())
  


ggplot(p2, aes(count_product)) + geom_histogram(binwidth = 10)+labs(title="Number of distinct products/user",
        x ="Number of Products", y = "Number of Users")+coord_cartesian(xlim = c(0, 250))


```

```{r}
#Number of distinct users/item



p3<-all %>% 
  group_by(product_id,user_id) %>% 
  summarise(count4=n()) %>% 
   select(user_id,product_id,count4) %>% 
  ungroup() %>%
  group_by(product_id) %>% 
  summarise(count_user=n()) %>% 
  ungroup() 
# %>% group_by(count_user) %>% 
#   summarise(count_product=n())


ggplot(p3, aes(count_user)) + geom_histogram(binwidth = 50)+labs(title="Number of distinct users/item",
        x ="Number of Users", y = "Number of Products")+coord_cartesian(xlim = c(0, 500))

 
```

```{r}


#Number of Orders by User/Product


p4<-prior_order %>% 
  group_by(user_id,product_id,order_id) %>% 
  ungroup() %>% 
  group_by(user_id,product_id) %>% 
  summarise(count_order=n()) %>%
  ungroup()%>% group_by(count_order) %>% 
summarise(count_user_product=n()) %>% 
  top_n(count_user_product)



p4

ggplot(p4, aes(count_order)) + geom_bar()+labs(title="Number of Orders by User/Product",
        x ="Number of Orders", y = "Number of Users/Products")



```
```{r include=FALSE}


#testing
prior_order %>% 
 filter( user_id==1 & product_id==196)
```

```{r}


#Extract columns for matrix
transactions<-prior_order[,c("user_id","product_id","order_id")]


#calculate sparsity of the dataframe
sparsity<-1-sum(transactions==0)/prod(dim(transactions))
sparsity
```
```{r}
#Sample dataset for Processing (top 50 products)

transactions_sample<-transactions %>% 
                     filter(product_id %in%top_products_prior$product_id)

```


```{r}
dim(transactions_sample)
sparsity<-1-sum(transactions_sample==0)/prod(dim(transactions))
sparsity

```



```{r}

```



