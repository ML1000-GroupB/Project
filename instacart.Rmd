---
title: "instacart"
author: 
date: "09/03/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(dplyr)
```


```{r}
#Import data

orders<-read.csv("orders.csv")
products<-read.csv("products.csv")
departments<-read.csv("departments.csv")
prior<-read.csv("order_products__prior.csv")
train<-read.csv("order_products__train.csv")


```
```{r}

#testing

head(orders)
#dim(orders)
orders %>% 
  filter(order_id==2)

orders %>% 
  filter(user_id==202279)
```
```{r}

#testing
head(prior)
prior %>% 
  filter(order_id==2)

```
```{r}
#merge prior & order 

prior_order<-orders %>% 
  filter(eval_set=="prior") %>% 
    left_join(prior,orders,by=c("order_id"))


```

```{r}

#testing
prior_order%>% 
  filter(order_id==2)


prior_order %>% 
  filter(user_id==202279)
```

```{r}
#merge train and order

train_order<-orders %>% 
  filter(eval_set=="train") %>% 
    left_join(train,orders,by=c("order_id"))


```



```{r}
#merge test and order

test_order<-orders %>% 
  filter(eval_set=="test") %>% 
    left_join(test,orders,by=c("order_id"))
```
```{r}
dim(prior_order)
dim(train_order)
dim(test_order)
```


```{r}
## Total users 

user_count<-unique(orders$user_id)
length(user_count)

```


```{r}
#total products
product_count<-unique(products$product_id)
length(product_count)

```


```{r}
#total products in prior
product_prior_count<-unique(prior_order$product_id)
length(product_prior_count)

```

```{r}
#total products in train

product_train_count<-unique(train_order$product_id)
length(product_train_count)
```

```{r}
#top 50 products

top_products<-train_order %>% 
 group_by(product_id) %>% 
 summarise(tot=n()) %>% 
 top_n(50) %>% 
arrange(desc(tot))

top_products

```


```{r}

#top 50 users for top 50 products

top_users<-train_order %>%
  filter(product_id %in% top_products$product_id ) %>% 
 group_by(user_id) %>% 
 summarise(tot=n()) %>% 
 arrange(desc(tot)) %>% 
 top_n(50)
top_users

```

```{r}

#transaction for top 50 products (train)

train_order %>% 
filter(user_id %in%top_users$user_id  & product_id %in% top_products$product_id)
```


```{r}

#transaction for top 50 products (prior)

prior_order %>% 
filter(user_id %in%top_users$user_id  & product_id %in% top_products$product_id)

```

